<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Ruler Example</title>
    <script src="ruler.js"></script>
    <script type="text/javascript" src="../src/ruler.js"></script>
    <style>
textarea {
    width: 400px;
    height: 600px;
}
    </style>
</head>
<body>
    <textarea></textarea>
    <script>
void function(argument) {

    var symbols = ruler.build(function() {/*!
# 直接定义
x=10
y=20

# 直接计算长度
d=10,10~200,200

# 定义点
p1=x,y
p2=x+30,y+100

# 定义线
l1=p1,p2
l2=p1,(70,93)

# 定义圆弧
a1=x,y,300
a2=x+30,y+100,d

# 两条直线相交
xll=l1*l2
xll=l1*((11,100),(100,d))

# 圆弧直线相交
xal=l1*a2

# 两个圆弧相交
xaa=a1*a2

# 取下标
xb=xaa[0]

# 取下标
i1=1
xb1=xaa[i1]
xb2=xaa[i1 - 1]

    */});

    var steps = [];
    var settled = {};
    var symbolMap = {};

    function buildPrev(symbal) {

    }

    function importStep(name) {

        if (settled[name]) return;

        var symbol = symbols[name];

        if (name.indexOf('{') === 0) {
            symbolMap[symbol.text] = name;
        }

        name = symbolMap[name] || name;

        if (symbol.type == 'number' &&  !symbol.operands) return;

        var prevs = [];
        if (symbol.operands) {
            symbol.operands.forEach(function(operand) {
                if (symbols[operand].type == 'number' && !symbols[operand].operands) prevs.push(symbols[operand].value);
                else {
                    importStep(operand);
                    prevs.push(operand);
                }
            });

            settled[name] = name + '=' + symbol.fn + '(' + prevs.join(', ') + ')';
        } else {
            settled[name] = name + '=' + symbol.value;
        }

        steps.push(settled[name]);

    }

    for (var name in symbols) {
        importStep(name);
    }

    console.log(symbols);

    document.querySelector('textarea').value = steps.join('\n');
}();
    </script>
</body>
</html>
